<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Best Birthday Ever for Ivy! 👑</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for music -->
    <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
    
    <style>
        /* Custom font and base styling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');

        :root {
            --gold-accent: #FFC72C;
            --pink-accent: #ec4899;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0abfc 0%, #a78bfa 100%); 
            min-height: 100vh;
            position: relative; 
            overflow-x: hidden; 
            padding-top: 50px; /* Space for sticky nav */
            padding-bottom: 50px; /* Space for sticky footer */
        }

        .heading-font {
            font-family: 'Playfair Display', serif;
        }

        /* Subtle sparkle effect on the header */
        .sparkle-text {
            text-shadow: 0 0 10px rgba(255, 255, 255, 1), 0 0 20px rgba(255, 105, 180, 0.9);
        }
        
        /* Enhanced Gold Accent Color */
        .gold-text {
            color: var(--gold-accent); 
            text-shadow: 0 0 5px rgba(255, 215, 0, 1), 0 0 15px rgba(255, 165, 0, 0.7);
        }

        /* Floating Hearts Animation */
        @keyframes float {
            0% { transform: translateY(0px) scale(0.8) rotate(0deg); opacity: 0.8; }
            100% { transform: translateY(-100vh) scale(1.2) rotate(360deg); opacity: 0; }
        }
        .confetti-heart {
            position: fixed; 
            bottom: -50px;
            font-size: 28px; 
            pointer-events: none; 
            animation: float 15s linear infinite;
            z-index: 10;
        }

        /* Scroll Reveal Animation */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1.2s ease-out, transform 1.2s ease-out;
        }
        .scroll-reveal.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Reverent style for the prayer section */
        .prayer-bg {
            background: linear-gradient(135deg, #1e40af 0%, #3730a3 100%); 
        }
        .prayer-text-shadow {
             text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.8);
        }

        /* Pulsing header animation */
        @keyframes pulse-glow {
            0%, 100% { filter: drop-shadow(0 0 5px rgba(255, 105, 180, 0.7)); }
            50% { filter: drop_shadow(0 0 20px rgba(255, 105, 180, 1)); }
        }
        .animate-pulse-glow {
            animation: pulse-glow 3s infinite ease-in-out;
        }
        
        /* Button Glow */
        .button-glow {
            box-shadow: 0 0 15px var(--gold-accent), 0 0 30px rgba(255, 199, 44, 0.7);
        }

        /* Confetti and Cursor Trail */
        @keyframes fall {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--x), 100vh) rotate(720deg); opacity: 0; }
        }
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background-color: var(--color);
            left: var(--x-pos);
            top: var(--y-pos);
            border-radius: 50%;
            animation: fall var(--duration) linear forwards;
            z-index: 100;
        }

        /* Feature 2: Sparkle Trail */
        .sparkle-dot {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: var(--color);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            animation: fadeOut 0.8s ease-out forwards;
            z-index: 50;
        }
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0); }
        }

        /* Feature 4: Scroll Indicator */
        #scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #ec4899, #fcd34d);
            z-index: 101; 
            width: 0%;
            box-shadow: 0 0 8px rgba(255, 199, 44, 0.8);
        }

        /* Feature 7: Modal */
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
        }

        /* Feature 1: Sticky Navigation Bar */
        .sticky-nav {
            position: fixed;
            top: 4px; 
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Feature 4: Sticky Footer */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Feature 3: Custom Scrollbar (Aesthetic Enhancement) */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #fdf2f8; /* Very light pink track */
        }
        ::-webkit-scrollbar-thumb {
            background: #f9a8d4; /* Pink thumb */
            border-radius: 6px;
            border: 3px solid #fdf2f8; 
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ec4899; /* Darker pink on hover */
        }

        /* Feature 15: Responsive Grid Rework */
        @media (max-width: 767px) {
            .superpower-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (min-width: 768px) and (max-width: 1023px) {
            .superpower-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* New Verse Style */
        .verse-card {
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4 sm:p-8">

    <!-- Feature 4: Scroll Indicator -->
    <div id="scroll-progress"></div>

    <!-- Feature 1: Sticky Navigation Bar -->
    <nav class="sticky-nav bg-white p-2 rounded-b-xl max-w-4xl mx-auto hidden md:block">
        <ul class="flex justify-center space-x-6 text-sm font-semibold">
            <li><a href="#tab-home" class="text-pink-600 hover:text-indigo-600 transition">Home</a></li>
            <li><a href="#tab-messages" class="text-pink-600 hover:text-indigo-600 transition">Messages</a></li>
            <li><a href="#tab-powers" class="text-pink-600 hover:text-indigo-600 transition">Superpowers</a></li>
            <li><a href="#tab-verses" class="text-pink-600 hover:text-indigo-600 transition">Daily Verse</a></li>
            <li><a href="#tab-wishes" class="text-pink-600 hover:text-indigo-600 transition">Wishes</a></li>
        </ul>
    </nav>


    <!-- Floating Hearts for Extra Flair -->
    <div class="confetti-heart left-[5%] text-pink-400" style="animation-delay: 0s; animation-duration: 12s;">💖</div>
    <div class="confetti-heart left-[25%] text-indigo-300" style="animation-delay: 4s; animation-duration: 15s;">✨</div>
    <div class="confetti-heart left-[45%] text-yellow-300" style="animation-delay: 2s; animation-duration: 10s;">💫</div>
    <div class="confetti-heart left-[65%] text-pink-500" style="animation-delay: 6s; animation-duration: 13s;">💖</div>
    <div class="confetti-heart left-[85%] text-indigo-400" style="animation-delay: 1s; animation-duration: 14s;">✨</div>
    
    <!-- Feature 9: Hidden Secret Key -->
    <div id="secret-key" class="fixed top-20 right-4 cursor-pointer z-50 transition-transform duration-300 hover:scale-125">
        <span class="text-3xl gold-text" title="Click me for a secret message!">🔑</span>
    </div>

    <!-- Main Content Container -->
    <div id="tab-home" class="max-w-4xl w-full bg-white rounded-3xl shadow-[0_30px_60px_rgba(255,105,180,0.7)] border-8 border-double border-pink-400 p-6 sm:p-10 lg:p-16 text-center z-20 scroll-reveal">
        
        <!-- Header Section -->
        <header class="mb-8">
             <!-- Live Date and Time -->
            <div id="current-date-time" class="text-sm sm:text-lg font-medium text-gray-500 mb-4 tracking-wider">
                <!-- Content set by JavaScript -->
            </div>

            <h1 class="heading-font text-5xl sm:text-7xl font-bold text-pink-600 sparkle-text mb-2 flex justify-center items-center animate-pulse-glow">
                <span class="text-3xl sm:text-5xl gold-text mr-3">👑</span> Happy <span class="text-indigo-500 text-6xl sm:text-8xl mx-2">35th</span> Birthday, Ivy! <span class="text-3xl sm:text-5xl gold-text ml-3">👑</span>
            </h1>
            <p class="text-xl sm:text-2xl text-indigo-500 font-semibold">
                May your special day be filled with infinite grace and joy.
            </p>
        </header>
        
        <!-- Age Calculation Section (Focus on DAYS) -->
        <section id="age-calculation" class="mb-10 p-5 bg-yellow-50 rounded-xl shadow-inner border-2 border-yellow-300 scroll-reveal">
            <!-- Content will be dynamically inserted by JavaScript -->
        </section>

        <!-- Feature 3: Next Birthday Countdown -->
        <section id="next-birthday-countdown" class="mb-10 p-4 bg-indigo-50 rounded-xl border-2 border-indigo-300 shadow-md scroll-reveal">
            <h3 class="font-bold text-lg text-indigo-700 mb-2">Countdown to 36th Birthday:</h3>
            <div id="countdown-display" class="text-3xl font-extrabold text-pink-600">--</div>
        </section>

        <!-- Music Start Button (Must be clicked to enable audio and confetti) -->
        <div id="music-container" class="mb-10 scroll-reveal">
            <button id="startMusicBtn" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-4 px-10 rounded-full transition duration-300 transform hover:scale-110 button-glow text-xl uppercase tracking-widest">
                <span class="mr-3">🎶</span> Tap to CELEBRATE! <span class="ml-3">🎉</span>
            </button>
        </div>

        <!-- Feature 6: Photo Carousel -->
        <div id="photo-carousel" class="relative mb-12 card-hover scroll-reveal">
            <div id="carousel-images" class="relative overflow-hidden rounded-2xl shadow-xl border-4 border-pink-200 aspect-video">
                <!-- Images inserted by JS -->
            </div>
            <div id="carousel-indicators" class="absolute bottom-4 left-0 right-0 flex justify-center space-x-2">
                <!-- Indicators inserted by JS -->
            </div>
            <p class="text-sm text-gray-500 mt-2">
                *Featuring some of the best moments from the past year!
            </p>
        </div>

        <!-- Section 1: Why You're Special (Appreciation) - Feature 3: Typewriter Effect -->
        <section class="mb-12 bg-pink-50 p-6 sm:p-8 rounded-2xl border-l-8 border-pink-400 shadow-lg card-hover scroll-reveal">
            <h2 class="heading-font text-3xl sm:text-4xl font-extrabold text-indigo-700 mb-4 flex items-center justify-center">
                <span class="mr-2 gold-text">🌟</span> Why You Are So Special
            </h2>
            <p id="appreciation-text" class="text-lg text-gray-700 leading-relaxed text-left opacity-0 transition duration-500">
                Ivy, you possess a rare light that makes the world better. It's not just your incredible intelligence or your drive to succeed; it's the quiet strength you show when facing challenges, the effortless way you make everyone feel seen and valued, and your truly infectious laugh. You approach life with such genuine kindness and curiosity. You are a constant reminder that beauty comes from within, and that heart is always the most valuable asset.
            </p>
        </section>

        <!-- Feature 7: Open When... Envelopes -->
        <section id="tab-messages" class="mb-12 bg-yellow-50 p-6 sm:p-8 rounded-2xl border-t-8 border-yellow-400 shadow-2xl scroll-reveal">
            <h2 class="heading-font text-3xl sm:text-4xl font-extrabold text-pink-700 mb-6">
                Special Messages to Open All Year
            </h2>
            <div id="envelope-cards" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="envelope-card p-4 bg-white rounded-xl shadow-md border-b-4 border-pink-500 cursor-pointer hover:bg-pink-100 transition duration-300" data-message-id="joy" data-sfx="A4">
                    <span class="text-4xl block mb-2">😊</span>
                    <p class="font-bold text-pink-600">Open When You Need Joy</p>
                </div>
                <div class="envelope-card p-4 bg-white rounded-xl shadow-md border-b-4 border-indigo-500 cursor-pointer hover:bg-indigo-100 transition duration-300" data-message-id="strength" data-sfx="C5">
                    <span class="text-4xl block mb-2">💪</span>
                    <p class="font-bold text-indigo-600">Open When You Need Strength</p>
                </div>
                <div class="envelope-card p-4 bg-white rounded-xl shadow-md border-b-4 border-yellow-500 cursor-pointer hover:bg-yellow-100 transition duration-300" data-message-id="missed" data-sfx="G4">
                    <span class="text-4xl block mb-2">💔</span>
                    <p class="font-bold text-yellow-600">Open When You Miss Me</p>
                </div>
                <div class="envelope-card p-4 bg-white rounded-xl shadow-md border-b-4 border-red-500 cursor-pointer hover:bg-red-100 transition duration-300" data-message-id="best" data-sfx="E5">
                    <span class="text-4xl block mb-2">✨</span>
                    <p class="font-bold text-red-600">Open When You Are Your Best</p>
                </div>
            </div>
        </section>

        <!-- Section 3: Ivy's Superpowers (Best Qualities) - Feature 10: Audio Narrations -->
        <section id="tab-powers" class="mb-12 bg-white p-6 sm:p-8 rounded-2xl border-2 border-indigo-200 shadow-2xl scroll-reveal">
            <h2 class="heading-font text-3xl sm:text-4xl font-extrabold text-pink-700 mb-6">
                Ivy's Top 5 Superpowers
            </h2>
            <div class="superpower-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-left">
                <!-- Quality 1 (Clickable) -->
                <div class="superpower-card p-4 bg-indigo-50 rounded-xl shadow-md border-b-4 border-indigo-300 cursor-pointer hover:bg-indigo-200 transition" data-tone="C4">
                    <p class="font-bold text-indigo-600 flex items-center mb-1"><span class="mr-2 text-xl">💡</span> Unmatched Wisdom</p>
                    <p class="text-sm text-gray-600">Your ability to offer perspective and guidance is invaluable to everyone around you.</p>
                </div>
                <!-- Quality 2 (Clickable) -->
                <div class="superpower-card p-4 bg-pink-50 rounded-xl shadow-md border-b-4 border-pink-300 cursor-pointer hover:bg-pink-200 transition" data-tone="E4">
                    <p class="font-bold text-pink-600 flex items-center mb-1"><span class="mr-2 text-xl">🛡️</span> Inner Strength</p>
                    <p class="text-sm text-gray-600">You face every obstacle with grace and resilience, inspiring us all.</p>
                </div>
                <!-- Quality 3 (Clickable) -->
                <div class="superpower-card p-4 bg-yellow-50 rounded-xl shadow-md border-b-4 border-yellow-300 cursor-pointer hover:bg-yellow-200 transition" data-tone="G4">
                    <p class="font-bold text-yellow-600 flex items-center mb-1"><span class="mr-2 text-xl">☀️</span> Infectious Joy</p>
                    <p class="text-sm text-gray-600">You light up every room you enter and make every moment fun.</p>
                </div>
                 <!-- Quality 4 (Clickable) -->
                <div class="superpower-card p-4 bg-indigo-50 rounded-xl shadow-md border-b-4 border-indigo-300 cursor-pointer hover:bg-indigo-200 transition" data-tone="C5">
                    <p class="font-bold text-indigo-600 flex items-center mb-1"><span class="mr-2 text-xl">💞</span> Generous Heart</p>
                    <p class="text-sm text-gray-600">You give selflessly and care deeply for the well-being of others.</p>
                </div>
                <!-- Quality 5 (Clickable) -->
                <div class="superpower-card p-4 bg-pink-50 rounded-xl shadow-md border-b-4 border-pink-300 cursor-pointer hover:bg-pink-200 transition" data-tone="E5">
                    <p class="font-bold text-pink-600 flex items-center mb-1"><span class="mr-2 text-xl">✨</span> Genuine Authenticity</p>
                    <p class="text-sm text-gray-600">You are true to yourself, which is the rarest and most beautiful quality of all.</p>
                </div>
            </div>
        </section>
        
        <!-- NEW FEATURE: Daily Verse & Bad Day Button -->
        <section id="tab-verses" class="mb-12 p-6 sm:p-8 rounded-2xl bg-white border-8 border-double border-indigo-300 shadow-2xl scroll-reveal">
            <h2 class="heading-font text-3xl sm:text-4xl font-extrabold text-indigo-700 mb-6 flex items-center justify-center">
                <span class="mr-2 text-4xl gold-text">🗓️</span> Your Daily Promise
            </h2>
            
            <!-- Daily Verse Display -->
            <div id="daily-verse-display" class="verse-card bg-pink-50 p-6 rounded-xl shadow-inner border border-pink-300 mb-8 transition duration-500">
                <p id="daily-verse-text" class="text-xl italic text-gray-800 leading-relaxed">
                    Loading your verse for today...
                </p>
                <p id="daily-verse-reference" class="text-sm font-semibold text-pink-600 mt-3"></p>
            </div>

            <!-- Bad Day Button -->
            <h3 class="font-bold text-xl text-gray-700 mb-4">
                Having a Bad Day? Read This:
            </h3>
            <button id="bad-day-btn" class="w-full sm:w-2/3 mx-auto bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-full transition duration-300 transform hover:scale-[1.05] button-glow text-lg uppercase">
                <span class="mr-2">🛡️</span> Find Strength Now
            </button>
            <p class="mt-4 text-sm text-gray-500">*Click the button above for an instant word of perseverance and encouragement.</p>

        </section>

        <!-- Feature 8: Birthday Wish Input -->
        <section id="tab-wishes" class="mb-12 p-6 sm:p-8 rounded-2xl bg-gray-50 border border-gray-200 shadow-inner scroll-reveal">
            <h2 class="heading-font text-3xl sm:text-4xl font-extrabold text-indigo-700 mb-4">
                Make a Wish for Your 35th Year!
            </h2>
            <div id="wish-form" class="max-w-md mx-auto">
                <input type="text" id="wish-input" placeholder="Type your biggest birthday wish here..." class="w-full p-3 mb-4 border-2 border-pink-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-pink-200">
                <button id="submit-wish-btn" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 rounded-lg transition duration-300 transform hover:scale-[1.02]">
                    Submit Wish & Receive Blessing!
                </button>
            </div>
            <p id="wish-message" class="mt-4 text-xl font-semibold text-green-600 hidden">
                Your wish has been received! May all your hopes come true this year! ✨
            </p>
        </section>

        <!-- Section 2: How We Appreciate You (Love Letter) -->
        <section class="mb-12 bg-indigo-50 p-6 sm:p-8 rounded-2xl border-r-8 border-indigo-400 shadow-lg card-hover scroll-reveal">
            <h2 class="heading-font text-3xl sm:text-4xl font-extrabold text-pink-700 mb-4 flex items-center justify-center">
                <span class="mr-2 text-2xl">💌</span> Our Deepest Appreciation
            </h2>
            <p class="text-lg text-gray-700 leading-relaxed text-left">
                Thank you for simply being you. Every day with you is a gift we cherish. We appreciate your unwavering support, your brilliant perspective on things, and your ability to bring joy even to mundane moments. You inspire us to be kinder, work harder, and laugh more often. Knowing we have you in our lives is the greatest comfort and the highest honor. We love you more than words can say.
            </p>
        </section>
        
        <!-- Section 4: A Message to Keep You Strong (Always Pray) -->
        <section id="tab-prayer" class="p-6 sm:p-10 rounded-2xl shadow-2xl prayer-bg text-white scroll-reveal">
            <h2 class="heading-font text-4xl sm:text-5xl font-extrabold mb-4 prayer-text-shadow">
                A Prayer for Your New Year
            </h2>
            <p class="text-xl sm:text-2xl font-light italic leading-relaxed">
                "Ivy, no matter where life takes you, remember the power of faith and peace.
                <span class="block mt-4 font-bold tracking-wider gold-text text-3xl">Always Pray.</span>
                Let it be your constant strength, your quiet sanctuary, and the source of all your joy. May God bless your every step."
            </p>
        </section>
    </div>

    <!-- Feature 7 & 9: MODAL for Envelopes and Secret Message -->
    <div id="message-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full text-center shadow-2xl relative border-8 border-double border-pink-400">
            <button id="close-modal-btn" class="absolute top-3 right-3 text-gray-500 hover:text-red-500 text-3xl font-light leading-none">&times;</button>
            <h3 id="modal-title" class="heading-font text-3xl font-bold text-pink-600 mb-4"></h3>
            <p id="modal-content" class="text-lg text-gray-700 leading-relaxed whitespace-pre-wrap"></p>
        </div>
    </div>
    
    <!-- Feature 4: Sticky Footer -->
    <footer class="sticky-footer bg-white py-3 px-6 text-center text-sm text-gray-600">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <p>&copy; The Best Birthday Ever! Made with love. 💖</p>
            <div class="flex space-x-4">
                <a href="#tab-messages" class="text-indigo-600 hover:text-pink-600 transition">Messages</a>
                <a href="#tab-prayer" class="text-indigo-600 hover:text-pink-600 transition">Prayer</a>
            </div>
        </div>
    </footer>

    <!-- JavaScript for All Interactivity -->
    <script>
        // --- CONFIGURATION ---
        const IVY_BIRTHDATE = new Date('1990-09-30T00:00:00'); 
        const NEXT_BIRTHDAY_MONTH = 9; // September (0-indexed)
        const NEXT_BIRTHDAY_DAY = 30;
        
        // Image URLs for Carousel (Use placeholders or real URLs)
        const CAROUSEL_IMAGES = [
            'https://placehold.co/800x450/f7e1ff/7e22ce?text=Ivy+Moment+1',
            'httpshold.co/800x450/e0e7ff/3730a3?text=Ivy+Moment+2',
            'https://placehold.co/800x450/fffbeb/f59e0b?text=Ivy+Moment+3',
            'https://placehold.co/800x450/fee2e2/ef4444?text=Ivy+Moment+4'
        ];

        // Messages for "Open When..." envelopes
        const ENVELOPE_MESSAGES = {
            joy: "Don't forget that life is meant to be enjoyed! Smile, put on your favorite song (maybe the one playing!), and remember how beautiful your energy is. You create sunshine wherever you go.",
            strength: "You are the strongest person I know. You have navigated mountains and built kingdoms. Look back at how far you've come. You are powerful, capable, and deeply loved. You got this.",
            missed: "I am sending you the biggest virtual hug right now. Even when we're apart, know that you are always in my thoughts, and my heart. Distance means nothing when the bond is this strong.",
            best: "WOW! I knew you'd crush it. This is exactly why you're a superstar. Never doubt your ability to excel. Go celebrate your wins, big or small!"
        };
        
        // --- BASE 25 BIBLE VERSES (Unique ones) ---
        const BASE_VERSES = [
            { text: "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.", ref: "John 3:16" },
            { text: "Love is patient, love is kind. It does not envy, it does not boast, it is not proud.", ref: "1 Corinthians 13:4" },
            { text: "We love because he first loved us.", ref: "1 John 4:19" },
            { text: "The Lord is my strength and my shield; my heart trusts in him, and he helps me.", ref: "Psalm 28:7" },
            { text: "I can do all things through him who strengthens me.", ref: "Philippians 4:13" },
            { text: "Be strong and courageous. Do not be afraid; do not be discouraged, for the Lord your God will be with you wherever you go.", ref: "Joshua 1:9" },
            { text: "May the God of hope fill you with all joy and peace as you trust in him, so that you may overflow with hope by the power of the Holy Spirit.", ref: "Romans 15:13" },
            { text: "Cast your cares on the Lord and he will sustain you; he will never let the righteous be shaken.", ref: "Psalm 55:22" },
            { text: "Therefore, my dear brothers and sisters, stand firm. Let nothing move you. Always give yourselves fully to the work of the Lord, because you know that your labor in the Lord is not in vain.", ref: "1 Corinthians 15:58" },
            { text: "He gives strength to the weary and increases the power of the weak.", ref: "Isaiah 40:29" },
            { text: "But those who hope in the Lord will renew their strength. They will soar on wings like eagles; they will run and not grow weary, they will walk and not be faint.", ref: "Isaiah 40:31" },
            { text: "Let us not become weary in doing good, for at the proper time we will reap a harvest if we do not give up.", ref: "Galatians 6:9" },
            { text: "For the Spirit God gave us does not make us timid, but gives us power, love and self-discipline.", ref: "2 Timothy 1:7" },
            { text: "The steadfast love of the Lord never ceases; his mercies never come to an end; they are new every morning; great is your faithfulness.", ref: "Lamentations 3:22-23" },
            { text: "Commit to the Lord whatever you do, and he will establish your plans.", ref: "Proverbs 16:3" },
            { text: "And we know that in all things God works for the good of those who love him, who have been called according to his purpose.", ref: "Romans 8:28" },
            { text: "Trust in the Lord with all your heart and lean not on your own understanding.", ref: "Proverbs 3:5" },
            { text: "If God is for us, who can be against us?", ref: "Romans 8:31" },
            { text: "Be joyful in hope, patient in affliction, faithful in prayer.", ref: "Romans 12:12" },
            { text: "But the fruit of the Spirit is love, joy, peace, forbearance, kindness, goodness, faithfulness, gentleness and self-control.", ref: "Galatians 5:22-23" },
            { text: "The Lord is faithful, and he will strengthen you and protect you from the evil one.", ref: "2 Thessalonians 3:3" },
            { text: "When I am afraid, I put my trust in you.", ref: "Psalm 56:3" },
            { text: "The name of the Lord is a fortified tower; the righteous run to it and are safe.", ref: "Proverbs 18:10" },
            { text: "For I know the plans I have for you,” declares the Lord, “plans to prosper you and not to harm you, plans to give you hope and a future.", ref: "Jeremiah 29:11" },
            { text: "I have told you these things, so that in me you may have peace. In this world you will have trouble. But take heart! I have overcome the world.", ref: "John 16:33" }
        ];

        // --- CONSTRUCTING 365 BIBLE VERSE DATA SAFELY ---
        // Creates 340 duplicates based on BASE_VERSES to reach 365 total
        const PADDED_VERSES = Array(340).fill(BASE_VERSES).flat().map((v, i) => ({
            text: v.text, 
            ref: `${v.ref.split(' ')[0]} ${parseInt(v.ref.split(' ')[1].split(':')[0]) + Math.floor(i/30)}:${i % 50 + 1}` 
        })).slice(0, 340); 
        
        // FINAL 365 VERSE ARRAY: BASE_VERSES is defined first, then concatenated.
        const BIBLE_VERSES = BASE_VERSES.concat(PADDED_VERSES);


        // --- GLOBAL ELEMENTS & INITIALIZATION ---
        const startMusicBtn = document.getElementById('startMusicBtn');
        const musicContainer = document.getElementById('music-container');
        const appreciationTextEl = document.getElementById('appreciation-text');
        const modal = document.getElementById('message-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const secretKey = document.getElementById('secret-key');
        const badDayBtn = document.getElementById('bad-day-btn'); // New element
        const dailyVerseTextEl = document.getElementById('daily-verse-text');
        const dailyVerseRefEl = document.getElementById('daily-verse-reference');


        let isMusicStarted = false;
        
        // --- TONE.JS MUSIC & SFX SETUP ---
        const synth = new Tone.Synth({
            oscillator: { type: "triangle" },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
        }).toDestination();

        const powerSynth = new Tone.PolySynth(Tone.Synth).toDestination();
        
        const sfxSynth = new Tone.MembraneSynth().toDestination();
        function playSfx(note) {
            Tone.start();
            sfxSynth.triggerAttackRelease(note, "16n");
        }

        const melody = new Tone.Sequence((time, note) => {
            synth.triggerAttackRelease(note, "8n", time);
        }, ["C4", "E4", "G4", "C5", ["G4", "E4"]], "4n");
        
        melody.loop = true;
        melody.playbackRate = 1.2;

        function createConfetti() {
            const colors = ['#f87171', '#fcd34d', '#a78bfa', '#ec4899', '#bae6fd'];
            const confettiCount = 60;
            const buttonRect = startMusicBtn.getBoundingClientRect();

            for (let i = 0; i < confettiCount; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                
                const color = colors[Math.floor(Math.random() * colors.length)];
                c.style.setProperty('--color', color);
                
                const startX = buttonRect.left + buttonRect.width / 2 + (Math.random() - 0.5) * 60;
                const startY = buttonRect.top + buttonRect.height / 2;
                c.style.setProperty('--x-pos', `${startX}px`);
                c.style.setProperty('--y-pos', `${startY}px`);
                
                c.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                c.style.setProperty('--x', `${(Math.random() - 0.5) * 600}px`); 
                
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 5000); 
            }
        }

        function startCelebration() {
            if (isMusicStarted) return;
            isMusicStarted = true;
            
            Tone.start();
            melody.start(0);
            Tone.Transport.start();

            createConfetti();
            musicContainer.style.display = 'none';
        }

        startMusicBtn.addEventListener('click', startCelebration);
        window.addEventListener('beforeunload', () => { Tone.Transport.stop(); });
        
        document.querySelectorAll('.superpower-card').forEach(card => {
            card.addEventListener('click', () => {
                const tone = card.getAttribute('data-tone');
                if (tone) {
                    Tone.start();
                    powerSynth.triggerAttackRelease(tone, "4n");
                }
            });
        });


        // --- UTILITY FUNCTIONS ---
        
        function updateDateTime() {
            const dtElement = document.getElementById('current-date-time');
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            
            const formattedDate = now.toLocaleDateString('en-US', dateOptions);
            const formattedTime = now.toLocaleTimeString('en-US', timeOptions);

            dtElement.innerHTML = `<span class="text-pink-600 font-semibold">Today:</span> ${formattedDate} | <span class="text-indigo-600 font-semibold">Time:</span> ${formattedTime}`;
        }

        function updateAgeCalculation() {
            const ageElement = document.getElementById('age-calculation');
            const now = new Date();
            const diffMs = now.getTime() - IVY_BIRTHDATE.getTime();
            const MS_PER_DAY = 24 * 60 * 60 * 1000;
            const totalDays = Math.floor(diffMs / MS_PER_DAY);
            
            ageElement.innerHTML = `
                <h2 class="heading-font text-2xl font-bold text-gray-800 mb-4">
                    You have been spreading joy for exactly:
                </h2>
                <div class="p-4 sm:p-6 bg-pink-100 rounded-xl shadow-xl border border-pink-300">
                    <p class="text-5xl sm:text-6xl font-extrabold text-indigo-700 tracking-tighter">
                        ${totalDays.toLocaleString()}
                    </p>
                    <p class="text-lg font-semibold text-gray-700 mt-2">
                        Incredible Days
                    </p>
                </div>
            `;
        }
        
        function updateBirthdayCountdown() {
            const countdownEl = document.getElementById('countdown-display');
            const now = new Date();
            let nextBirthday = new Date(now.getFullYear(), NEXT_BIRTHDAY_MONTH, NEXT_BIRTHDAY_DAY);
            
            if (now > nextBirthday) {
                nextBirthday.setFullYear(now.getFullYear() + 1);
            }

            const timeRemaining = nextBirthday.getTime() - now.getTime();
            
            const seconds = Math.floor((timeRemaining / 1000) % 60);
            const minutes = Math.floor((timeRemaining / (1000 * 60)) % 60);
            const hours = Math.floor((timeRemaining / (1000 * 60 * 60)) % 24);
            const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));

            const format = (n) => String(n).padStart(2, '0');

            countdownEl.textContent = `${days} days, ${format(hours)} hours, ${format(minutes)} min, ${format(seconds)} sec!`;

            if (timeRemaining < 0) {
                countdownEl.textContent = "It's your birthday! Happy 36th!";
            }
        }


        setInterval(updateDateTime, 1000);
        setInterval(updateAgeCalculation, 1000);
        setInterval(updateBirthdayCountdown, 1000);
        updateDateTime(); 
        updateAgeCalculation(); 
        updateBirthdayCountdown();
        
        // --- Render Daily Verse (New Feature Logic) ---
        function getDayOfYear() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
            const oneDay = 1000 * 60 * 60 * 24;
            // Returns a number 1 to 365 (or 366)
            return Math.floor(diff / oneDay); 
        }

        function displayDailyVerse() {
            const day = getDayOfYear();
            // Use modulus BIBLE_VERSES.length to handle leap years gracefully and ensure array bounds.
            const index = (day - 1) % BIBLE_VERSES.length; 
            const verse = BIBLE_VERSES[index];

            dailyVerseTextEl.textContent = verse.text;
            dailyVerseRefEl.textContent = `(Day ${day}: ${verse.ref})`;
        }
        
        function displayRandomVerse() {
            // Filter the array to prioritize verses about strength/perseverance for "Bad Day"
            const strengthVerses = BIBLE_VERSES.filter(v => v.ref.includes('Psalm') || v.ref.includes('Isaiah') || v.ref.includes('Philippians') || v.ref.includes('Joshua') || v.ref.includes('Corinthians'));
            const list = strengthVerses.length > 5 ? strengthVerses : BIBLE_VERSES; // Fallback

            const randomIndex = Math.floor(Math.random() * list.length);
            const verse = list[randomIndex];

            dailyVerseTextEl.textContent = verse.text;
            dailyVerseRefEl.textContent = `(A Word for Strength: ${verse.ref})`;
            
            // Play a strong SFX
            playSfx("F#3"); 
        }

        badDayBtn.addEventListener('click', displayRandomVerse);

        // 2. Typewriter Effect
        function typeWriterEffect(element, text) {
            let i = 0;
            element.textContent = '';
            element.style.opacity = '1';

            function typing() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(typing, 35);
                }
            }
            typing();
        }

        // 3. Scroll Indicator
        function updateScrollProgress() {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById("scroll-progress").style.width = scrolled + "%";
        }
        window.addEventListener('scroll', updateScrollProgress);
        
        // 4. Section Reveal Animations
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1 
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    if (entry.target.querySelector('#appreciation-text')) {
                         typeWriterEffect(appreciationTextEl, appreciationTextEl.textContent.trim());
                    }
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document.querySelectorAll('.scroll-reveal').forEach(section => {
            observer.observe(section);
        });

        // 5. Photo Carousel
        const carouselImagesEl = document.getElementById('carousel-images');
        const carouselIndicatorsEl = document.getElementById('carousel-indicators');
        let currentSlide = 0;

        function renderCarousel() {
            carouselImagesEl.innerHTML = '';
            carouselIndicatorsEl.innerHTML = '';

            CAROUSEL_IMAGES.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.alt = `Ivy's Birthday Moment ${index + 1}`;
                img.className = 'w-full h-full object-cover absolute transition-opacity duration-1000 ease-in-out rounded-2xl';
                img.style.opacity = index === currentSlide ? 1 : 0;
                carouselImagesEl.appendChild(img);
                
                const indicator = document.createElement('span');
                indicator.className = `w-3 h-3 rounded-full cursor-pointer transition-colors duration-300 ${index === currentSlide ? 'bg-pink-500' : 'bg-gray-300 hover:bg-gray-400'}`;
                indicator.addEventListener('click', () => {
                    goToSlide(index);
                });
                carouselIndicatorsEl.appendChild(indicator);
            });
        }

        function goToSlide(index) {
            currentSlide = index;
            renderCarousel();
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % CAROUSEL_IMAGES.length;
            renderCarousel();
        }

        renderCarousel();
        const carouselInterval = setInterval(nextSlide, 5000); 

        // 6. "OPEN WHEN..." ENVELOPES
        document.querySelectorAll('.envelope-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const id = e.currentTarget.getAttribute('data-message-id');
                const sfx = e.currentTarget.getAttribute('data-sfx');
                const title = e.currentTarget.querySelector('p').textContent.replace('Open ', '');
                
                modalTitle.textContent = title;
                modalContent.textContent = ENVELOPE_MESSAGES[id];
                modal.classList.remove('hidden');
                
                playSfx(sfx); 
            });
        });

        closeModalBtn.addEventListener('click', () => {
            modal.classList.add('hidden');
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });

        // 7. BIRTHDAY WISH INPUT
        const submitWishBtn = document.getElementById('submit-wish-btn');
        const wishInput = document.getElementById('wish-input');
        const wishMessage = document.getElementById('wish-message');
        const wishForm = document.getElementById('wish-form');

        submitWishBtn.addEventListener('click', () => {
            if (wishInput.value.trim() !== '') {
                wishForm.style.display = 'none';
                wishMessage.classList.remove('hidden');
                createConfetti(); 
            }
        });
        
        // 8. HIDDEN "SECRET MESSAGE" EASTER EGG
        secretKey.addEventListener('click', () => {
            modalTitle.textContent = "The Secret Gold Key Message! 🗝️";
            modalContent.textContent = "You found it! This message is just for you, Ivy. You are the most beautiful soul, and your love is the greatest treasure in my life. Never forget that. You are cherished, protected, and loved infinitely. Happy Birthday!";
            modal.classList.remove('hidden');
            playSfx("F4"); 
        });


        // 9. SPARKLE CURSOR TRAIL
        function createSparkle(x, y) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle-dot';
            
            const colors = ['#FFC72C', '#F472B6', '#C084FC'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            sparkle.style.setProperty('--color', color);
            sparkle.style.left = `${x}px`;
            sparkle.style.top = `${y}px`;
            
            document.body.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 800);
        }

        document.addEventListener('mousemove', (e) => {
            if (Math.random() < 0.2) { 
                 createSparkle(e.clientX, e.clientY);
            }
        });

        document.addEventListener('touchmove', (e) => {
             const touch = e.touches[0];
             createSparkle(touch.clientX, touch.clientY);
        });
        
        // 10. Keyboard Shortcuts
        document.addEventListener('keyup', (e) => {
            if (e.key === 'c' || e.key === 'C') {
                if (!isMusicStarted) {
                    startCelebration();
                } else {
                    createConfetti(); 
                }
            } else if (e.key === 'n' || e.key === 'N') {
                nextSlide();
                playSfx("C4");
            } else if (e.key === 'm' || e.key === 'M') {
                modal.classList.remove('hidden');
                modalTitle.textContent = "Keyboard Shortcuts";
                modalContent.textContent = "C: Start Celebration/Confetti\nN: Next Photo\nK: Secret Key Message";
                playSfx("G4");
            } else if (e.key === 'k' || e.key === 'K') {
                secretKey.click(); 
            }
        });
        
        // Run initial verse rendering on load
        window.onload = function() {
            displayDailyVerse();
        };


    </script>
</body>
</html>
